<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>مشغل بث Kick</title>
    <link href="https://vjs.zencdn.net/8.10.0/video-js.css" rel="stylesheet" />
    <style>
        body { background-color: #111; color: white; font-family: sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; margin: 0; }
        .video-container { width: 90%; max-width: 800px; border: 2px solid #53fc18; border-radius: 8px; overflow: hidden; background: #000; }
        #my-video { width: 100%; aspect-ratio: 16/9; }
        .status { margin-top: 15px; color: #ccc; }
    </style>
</head>
<body>

    <div class="video-container">
        <video id="my-video" class="video-js vjs-default-skin vjs-big-play-centered" controls preload="auto">
            <p class="vjs-no-js">للمشاهدة، يرجى تفعيل JavaScript في متصفحك.</p>
        </video>
    </div>

    <div id="status" class="status">جاري جلب البث...</div>

    <script src="https://vjs.zencdn.net/8.10.0/video.min.js"></script>

    <script>
        async function initPlayer(channelName) {
            const statusEl = document.getElementById('status');
            
            try {
                // 1. طلب تشغيل الملف getStream.js الموجود في مجلد api
                // نرسل اسم القناة كمعامل (Query Parameter)
                const response = await fetch(`/api/getStream?channel=${channelName}`);
                
                if (!response.ok) throw new Error('فشل الاتصال بالخادم');

                const data = await response.json();

                // 2. التأكد من الحصول على رابط البث (m3u8)
                if (data.url) {
                    statusEl.innerText = "متصل ببث: " + channelName;
                    
                    // 3. تهيئة المشغل وتشغيل الرابط
                    var player = videojs('my-video');
                    player.src({
                        src: data.url,
                        type: 'application/x-mpegURL'
                    });
                    
                    player.play().catch(error => {
                        console.log("التشغيل التلقائي محجوب، يرجى الضغط على زر التشغيل.");
                    });
                } else {
                    statusEl.innerText = "القناة غير موجودة أو ليست في وضع البث حالياً.";
                }
            } catch (error) {
                console.error("خطأ:", error);
                statusEl.innerText = "حدث خطأ أثناء محاولة جلب البيانات.";
            }
        }

        // قم بتغيير 'اسم_القناة' هنا للاسم الذي تريد عرضه
        initPlayer('sxb');
    </script>
</body>
</html>
